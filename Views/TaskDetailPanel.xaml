<UserControl x:Class="TaskTool.Views.TaskDetailPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Visibility="{Binding SelectedTask, Converter={StaticResource NullToVisibilityConverter}}"
             Background="{StaticResource BgBrush}">
    <UserControl.Resources>
        <DataTemplate x:Key="TwoDigitNumberTemplate">
            <TextBlock Text="{Binding StringFormat={}{0:00}}" Foreground="{StaticResource TextBrush}"/>
        </DataTemplate>
        <DataTemplate x:Key="DurationNumberTemplate">
            <TextBlock Text="{Binding StringFormat={}{0} min}" Foreground="{StaticResource TextBrush}"/>
        </DataTemplate>
    </UserControl.Resources>
    <ScrollViewer VerticalScrollBarVisibility="Auto" Background="Transparent">
        <StackPanel>
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Task Details" FontSize="13" Foreground="{StaticResource MutedTextBrush}"/>
                    <TextBlock Text="{Binding SelectedTask.Title}" FontSize="28" FontWeight="Bold" Margin="0,4,0,10" TextWrapping="Wrap"/>
                    <TextBox Text="{Binding SelectedTask.Description, UpdateSourceTrigger=PropertyChanged}" Height="100" AcceptsReturn="True" VerticalScrollBarVisibility="Auto"/>
                    <TextBox Text="{Binding SelectedTask.TicketUrl, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Scheduling" FontWeight="SemiBold" Margin="0,6,0,6"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="70"/>
                            <ColumnDefinition Width="70"/>
                        </Grid.ColumnDefinitions>
                        <DatePicker Grid.Column="0" SelectedDate="{Binding SelectedStartDate}"/>
                        <ComboBox Grid.Column="1" ItemsSource="{Binding Hours}" SelectedItem="{Binding SelectedHour}" ItemTemplate="{StaticResource TwoDigitNumberTemplate}" Margin="6,2,6,8"/>
                        <ComboBox Grid.Column="2" ItemsSource="{Binding Minutes}" SelectedItem="{Binding SelectedMinute}" ItemTemplate="{StaticResource TwoDigitNumberTemplate}" Margin="0,2,0,8"/>
                    </Grid>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <ComboBox Grid.Column="0" ItemsSource="{Binding DurationOptions}" SelectedItem="{Binding SelectedDurationMinutes}" ItemTemplate="{StaticResource DurationNumberTemplate}"/>
                        <TextBox Grid.Column="1" Text="{Binding ManualDurationMinutesText, UpdateSourceTrigger=PropertyChanged}" Margin="8,2,8,8"/>
                        <TextBlock Grid.Column="2" Text="{Binding ComputedEndText, StringFormat=Ende: {0}}" VerticalAlignment="Center" Foreground="{StaticResource MutedTextBrush}"/>
                    </Grid>

                    <TextBlock Text="{Binding DateTimeFormat, StringFormat=Format: {0}}" Foreground="{StaticResource MutedTextBrush}" Margin="0,0,0,4"/>
                    <TextBlock Text="{Binding OutlookSyncHint}" Foreground="#FCA5A5" Margin="0,0,0,8"/>

                    <WrapPanel>
                        <Button Content="Speichern" Width="94" Command="{Binding SaveCommand}"/>
                        <Button Content="Erledigt" Width="94" Style="{StaticResource SuccessButtonStyle}" Command="{Binding DoneCommand}"/>
                        <Button Content="Zurück zu Aktuell" Width="94" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding ReopenCommand}"/>
                    </WrapPanel>

                    <TextBlock Text="{Binding OutlookBlockerButtonText}" Foreground="{StaticResource MutedTextBrush}"/>
                    <WrapPanel>
                        <Button Content="Outlook Blocker sync" Width="180" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding SyncOutlookBlockerCommand}" IsEnabled="{Binding OutlookBlockerCanSync}"/>
                        <Button Content="Outlook Blocker löschen" Width="180" Style="{StaticResource DangerButtonStyle}" Command="{Binding DeleteOutlookBlockerCommand}"/>
                        <Button Content="Outlook Verbindung testen" Width="200" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding TestOutlookConnectionCommand}"/>
                    </WrapPanel>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}" Visibility="{Binding AllowMultiDaySegments, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel>
                    <TextBlock Text="Planung (Segmente)" FontWeight="SemiBold" Margin="0,0,0,8"/>
                    <WrapPanel>
                        <Button Content="Segment hinzufügen" Width="160" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding AddSegmentCommand}"/>
                        <Button Content="Alle Segmente zu Outlook" Width="200" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding SyncAllSegmentsCommand}"/>
                    </WrapPanel>
                    <ItemsControl ItemsSource="{Binding Segments}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#0B1220" BorderBrush="{StaticResource BorderBrushColor}" BorderThickness="1" CornerRadius="8" Padding="8" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="{Binding StartLocal, StringFormat=Start: {0:yyyy-MM-dd HH:mm}}"/>
                                        <TextBlock Text="{Binding EndLocal, StringFormat=Ende: {0:yyyy-MM-dd HH:mm}}"/>
                                        <TextBlock Text="{Binding PlannedMinutes, StringFormat=Geplant: {0} min}" Foreground="{StaticResource MutedTextBrush}"/>
                                        <TextBlock Text="{Binding OutlookEntryId, StringFormat=Outlook: {0}}" Foreground="{StaticResource MutedTextBrush}"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Timer" FontSize="13" Foreground="{StaticResource MutedTextBrush}"/>
                    <TextBlock Text="{Binding TimerDisplay}" FontSize="42" FontWeight="Bold" Margin="0,6,0,16" HorizontalAlignment="Center"/>
                    <WrapPanel HorizontalAlignment="Center">
                        <Button Content="Start" Width="90" Command="{Binding StartTimerCommand}"/>
                        <Button Content="Pause" Width="90" Style="{StaticResource WarningButtonStyle}" Command="{Binding PauseTimerCommand}"/>
                        <Button Content="Stop" Width="90" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding StopTimerCommand}"/>
                    </WrapPanel>
                    <WrapPanel HorizontalAlignment="Center">
                        <Button Content="+15" Width="90" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding Add15Command}"/>
                        <Button Content="+30" Width="90" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding Add30Command}"/>
                        <Button Content="+1h" Width="90" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding Add60Command}"/>
                    </WrapPanel>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
