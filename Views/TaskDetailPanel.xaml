<UserControl x:Class="TaskTool.Views.TaskDetailPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Visibility="{Binding SelectedTask, Converter={StaticResource NullToVisibilityConverter}}"
             Background="{StaticResource BgBrush}">
    <ScrollViewer VerticalScrollBarVisibility="Auto" Background="Transparent">
        <StackPanel>
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Task Details" FontSize="13" Foreground="{StaticResource MutedTextBrush}"/>
                    <TextBlock Text="{Binding SelectedTask.Title}" FontSize="28" FontWeight="Bold" Margin="0,4,0,10" TextWrapping="Wrap"/>

                    <TextBlock Text="Beschreibung" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding SelectedTask.Description, UpdateSourceTrigger=PropertyChanged}" Height="100" AcceptsReturn="True" VerticalScrollBarVisibility="Auto"/>

                    <TextBlock Text="Ticket URL" FontWeight="SemiBold" Foreground="{StaticResource TextBrush}" Margin="0,8,0,4"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0" Text="{Binding SelectedTask.TicketUrl, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Grid.Column="1" Content="Öffnen" Width="84" Style="{StaticResource SecondaryButtonStyle}" Margin="8,0,0,0"
                                Command="{Binding OpenTicketUrlCommand}" CommandParameter="{Binding SelectedTask.TicketUrl}"/>
                    </Grid>

                    <WrapPanel Margin="0,8,0,0">
                        <Button Content="Speichern" Width="94" Command="{Binding SaveCommand}"/>
                        <Button Content="Erledigt" Width="94" Style="{StaticResource SuccessButtonStyle}" Command="{Binding DoneCommand}"/>
                        <Button Content="Zurück zu Aktuell" Width="120" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding ReopenCommand}"/>
                    </WrapPanel>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Timer" FontSize="13" Foreground="{StaticResource MutedTextBrush}"/>
                    <TextBlock Text="{Binding TimerDisplay}" FontSize="42" FontWeight="Bold" Margin="0,6,0,16" HorizontalAlignment="Center"/>
                    <WrapPanel HorizontalAlignment="Center">
                        <Button Content="Start" Width="90" Command="{Binding StartTimerCommand}"/>
                        <Button Content="Pause" Width="90" Style="{StaticResource WarningButtonStyle}" Command="{Binding PauseTimerCommand}"/>
                        <Button Content="Stop" Width="90" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding StopTimerCommand}"/>
                    </WrapPanel>
                    <WrapPanel HorizontalAlignment="Center">
                        <Button Content="+15" Width="90" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding Add15Command}"/>
                        <Button Content="+30" Width="90" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding Add30Command}"/>
                        <Button Content="+1h" Width="90" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding Add60Command}"/>
                    </WrapPanel>
                    <WrapPanel HorizontalAlignment="Center">
                        <Button Content="-15" Width="90" Style="{StaticResource DangerButtonStyle}" Command="{Binding Subtract15Command}"/>
                        <Button Content="-30" Width="90" Style="{StaticResource DangerButtonStyle}" Command="{Binding Subtract30Command}"/>
                        <Button Content="-1h" Width="90" Style="{StaticResource DangerButtonStyle}" Command="{Binding Subtract60Command}"/>
                    </WrapPanel>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="Planung (Segmente)" FontWeight="SemiBold" Margin="0,0,0,8"/>

                    <Border Background="#0B1220" BorderBrush="{StaticResource BorderBrushColor}" BorderThickness="1" CornerRadius="8" Padding="8" Margin="0,0,0,8">
                        <StackPanel>
                            <TextBlock Text="Neues Segment" FontWeight="SemiBold" Margin="0,0,0,6"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="90"/>
                                    <ColumnDefinition Width="90"/>
                                </Grid.ColumnDefinitions>
                                <DatePicker Grid.Column="0" SelectedDate="{Binding NewSegmentDate, UpdateSourceTrigger=PropertyChanged}"/>
                                <TextBox Grid.Column="1" Margin="6,0,0,0" Text="{Binding NewSegmentStartTime, UpdateSourceTrigger=PropertyChanged}" ToolTip="HH:mm"/>
                                <TextBox Grid.Column="2" Margin="6,0,0,0" Text="{Binding NewSegmentEndTime, UpdateSourceTrigger=PropertyChanged}" ToolTip="HH:mm"/>
                            </Grid>
                            <TextBox Margin="0,8,0,0" Text="{Binding NewSegmentNote, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="{Binding NewSegmentValidationHint}" Foreground="#FCA5A5" Margin="0,6,0,0"/>
                            <WrapPanel Margin="0,6,0,0">
                                <Button Content="Segment speichern" Width="140" Command="{Binding AddSegmentCommand}" IsEnabled="{Binding CanSaveNewSegment}"/>
                                <Button Content="Alle Segmente zu Outlook" Width="190" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding SyncAllSegmentsCommand}"/>
                                <Button Content="Outlook Verbindung testen" Width="190" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding TestOutlookConnectionCommand}"/>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <ItemsControl ItemsSource="{Binding Segments}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#0B1220" BorderBrush="{StaticResource BorderBrushColor}" BorderThickness="1" CornerRadius="8" Padding="8" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="{Binding DisplayIndex, StringFormat=Segment {0}}" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,6"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="90"/>
                                                <ColumnDefinition Width="90"/>
                                            </Grid.ColumnDefinitions>
                                            <DatePicker Grid.Column="0" SelectedDate="{Binding SegmentDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                            <TextBox Grid.Column="1" Margin="6,0,0,0" Text="{Binding StartTimeText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" ToolTip="HH:mm"/>
                                            <TextBox Grid.Column="2" Margin="6,0,0,0" Text="{Binding EndTimeText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" ToolTip="HH:mm"/>
                                        </Grid>

                                        <TextBox Margin="0,8,0,0" Text="{Binding Note, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                        <TextBlock Text="{Binding PlannedMinutes, StringFormat=Dauer: {0} min}" Foreground="{StaticResource MutedTextBrush}"/>
                                        <TextBlock Text="{Binding OutlookStatus, StringFormat=Outlook Status: {0}}" Foreground="{StaticResource MutedTextBrush}"/>
                                        <TextBlock Text="{Binding ValidationHint}" Foreground="#FCA5A5"/>

                                        <WrapPanel Margin="0,6,0,0">
                                            <Button Content="Speichern" Width="90" Command="{Binding DataContext.SaveSegmentCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" CommandParameter="{Binding}"/>
                                            <Button Content="Löschen" Width="90" Style="{StaticResource DangerButtonStyle}" Command="{Binding DataContext.DeleteSegmentCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" CommandParameter="{Binding}"/>
                                            <Button Content="Outlook Blocker erstellen/aktualisieren" Width="220" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding DataContext.SyncSegmentOutlookCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" CommandParameter="{Binding}"/>
                                            <Button Content="Outlook Blocker löschen" Width="170" Style="{StaticResource DangerButtonStyle}" Command="{Binding DataContext.DeleteSegmentOutlookCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" CommandParameter="{Binding}"/>
                                        </WrapPanel>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
